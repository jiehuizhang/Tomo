<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>graph_classification &mdash; Tomosynthesis Machine Learning 1.0 documentation</title>
    
    <link rel="stylesheet" href="../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '1.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="top" title="Tomosynthesis Machine Learning 1.0 documentation" href="../index.html" />
    <link rel="up" title="Module code" href="index.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../Tomo.html">Tomosynthesis Machine Learning 1.0 documentation</a> &raquo;</li>
          <li><a href="index.html" accesskey="U">Module code</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <h1>Source code for graph_classification</h1><div class="highlight"><pre>
<span class="sd">&quot;&quot;&quot; Binaray classification using graphcut &quot;&quot;&quot;</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">cmath</span>
<span class="kn">import</span> <span class="nn">math</span>

<span class="kn">import</span> <span class="nn">ImageIO</span>
<span class="kn">import</span> <span class="nn">TImage</span>
<span class="kn">import</span> <span class="nn">TPatch</span>

<span class="kn">from</span> <span class="nn">pygraph.classes.graph</span> <span class="kn">import</span> <span class="n">graph</span>
<span class="kn">from</span> <span class="nn">pygraph.classes.digraph</span> <span class="kn">import</span> <span class="n">digraph</span>
<span class="kn">from</span> <span class="nn">pygraph.algorithms.minmax</span> <span class="kn">import</span> <span class="n">minimal_spanning_tree</span><span class="p">,</span>\
<span class="n">shortest_path</span><span class="p">,</span> <span class="n">heuristic_search</span><span class="p">,</span> <span class="n">shortest_path_bellman_ford</span><span class="p">,</span> <span class="n">maximum_flow</span><span class="p">,</span> <span class="n">cut_tree</span>

<span class="kn">from</span> <span class="nn">pyentropy</span> <span class="kn">import</span> <span class="n">DiscreteSystem</span>
<span class="kn">import</span> <span class="nn">MI</span>
<span class="kn">import</span> <span class="nn">Dimreduction</span>
<span class="kn">import</span> <span class="nn">histEqualization</span>
    
<div class="viewcode-block" id="computeFeatureCorrelation"><a class="viewcode-back" href="../graph_classification.html#graph_classification.computeFeatureCorrelation">[docs]</a><span class="k">def</span> <span class="nf">computeFeatureCorrelation</span><span class="p">(</span><span class="n">featSuspicious</span><span class="p">,</span> <span class="n">featSource</span><span class="p">,</span> <span class="n">featSink</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Computer extracted feature correlation</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    featSuspicious:</span>
<span class="sd">        Testing feature table</span>
<span class="sd">    featSource:</span>
<span class="sd">        Training positive feature table</span>
<span class="sd">    featSink:</span>
<span class="sd">        Training negative feature table   </span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">numSus</span> <span class="o">=</span> <span class="n">featSuspicious</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">numSor</span> <span class="o">=</span> <span class="n">featSource</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">numSin</span> <span class="o">=</span> <span class="n">featSink</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

    <span class="n">dataCombo</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">featSource</span><span class="p">,</span> <span class="n">featSink</span><span class="p">,</span> <span class="n">featSuspicious</span><span class="p">))</span>
    
    <span class="c"># dimensionality reduction </span>
    <span class="n">n_components</span> <span class="o">=</span> <span class="mi">5</span>
    <span class="n">data_projected</span> <span class="o">=</span> <span class="n">Dimreduction</span><span class="o">.</span><span class="n">dim_Reduction</span><span class="p">(</span><span class="n">dataCombo</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="s">&#39;pca&#39;</span><span class="p">,</span> <span class="n">n_components</span><span class="p">)</span>

    <span class="c"># Normialize feature vectors</span>
    <span class="n">norm</span> <span class="o">=</span> <span class="n">normalize</span><span class="p">(</span><span class="n">data_projected</span><span class="p">)</span>
    <span class="n">featSource</span> <span class="o">=</span> <span class="n">norm</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">numSor</span><span class="p">,:]</span>
    <span class="n">featSink</span> <span class="o">=</span> <span class="n">norm</span><span class="p">[</span><span class="n">numSor</span><span class="p">:</span><span class="n">numSor</span><span class="o">+</span><span class="n">numSin</span><span class="p">,:]</span>
    <span class="n">featSuspicious</span> <span class="o">=</span> <span class="n">norm</span><span class="p">[</span><span class="n">numSor</span><span class="o">+</span><span class="n">numSin</span><span class="p">:</span><span class="n">numSor</span><span class="o">+</span><span class="n">numSin</span><span class="o">+</span><span class="n">numSus</span><span class="p">,:]</span>

    <span class="c"># for debugging</span>
    <span class="c">#outputPath = &#39;C:/Tomosynthesis/localtest/res/&#39;   </span>
    <span class="c">#np.savetxt(outputPath + &#39;norm.txt&#39;, norm, delimiter=&#39;\t&#39;)</span>
    
    <span class="n">weightFeat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">numSus</span> <span class="o">+</span> <span class="n">numSor</span> <span class="o">+</span> <span class="n">numSin</span><span class="p">,</span><span class="n">numSus</span> <span class="o">+</span> <span class="n">numSor</span> <span class="o">+</span> <span class="n">numSin</span><span class="p">),</span><span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">double</span><span class="p">)</span>
	
    <span class="n">val_min</span> <span class="o">=</span> <span class="mf">0.0</span>
    <span class="n">val_max</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">n_components</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">numSor</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">numSor</span><span class="p">):</span>
            <span class="n">weightFeat</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">val_min</span> <span class="c">#computeDis(featSource[i],featSource[j])</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">numSin</span><span class="p">):</span>
            <span class="n">weightFeat</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="o">+</span><span class="n">numSor</span><span class="p">]</span> <span class="o">=</span> <span class="n">val_max</span> <span class="c">#computeDis(featSource[i],featSink[j])</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">numSus</span><span class="p">):</span>
            <span class="n">weightFeat</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="o">+</span><span class="n">numSor</span><span class="o">+</span><span class="n">numSin</span><span class="p">]</span> <span class="o">=</span> <span class="n">computeDis</span><span class="p">(</span><span class="n">featSource</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">featSuspicious</span><span class="p">[</span><span class="n">j</span><span class="p">])</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">numSin</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">numSin</span><span class="p">):</span>
            <span class="n">weightFeat</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="n">numSor</span><span class="p">][</span><span class="n">j</span><span class="o">+</span><span class="n">numSor</span><span class="p">]</span> <span class="o">=</span> <span class="n">val_min</span> <span class="c">#computeDis(featSink[i],featSink[j])</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">numSus</span><span class="p">):</span>
            <span class="n">weightFeat</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="n">numSor</span><span class="p">][</span><span class="n">j</span><span class="o">+</span><span class="n">numSor</span><span class="o">+</span><span class="n">numSin</span><span class="p">]</span> <span class="o">=</span> <span class="n">computeDis</span><span class="p">(</span><span class="n">featSink</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">featSuspicious</span><span class="p">[</span><span class="n">j</span><span class="p">])</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">numSus</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">numSus</span><span class="p">):</span>
            <span class="n">weightFeat</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="n">numSor</span><span class="o">+</span><span class="n">numSin</span><span class="p">][</span><span class="n">j</span><span class="o">+</span><span class="n">numSor</span><span class="o">+</span><span class="n">numSin</span><span class="p">]</span> <span class="o">=</span> <span class="n">computeDis</span><span class="p">(</span><span class="n">featSuspicious</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">featSuspicious</span><span class="p">[</span><span class="n">j</span><span class="p">])</span>			
        
    <span class="k">return</span> <span class="n">weightFeat</span>
</div>
<div class="viewcode-block" id="normalize"><a class="viewcode-back" href="../graph_classification.html#graph_classification.normalize">[docs]</a><span class="k">def</span> <span class="nf">normalize</span><span class="p">(</span><span class="n">comb</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Feature normalization&quot;&quot;&quot;</span>

    <span class="n">cmax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">amax</span><span class="p">(</span><span class="n">comb</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">cmin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">amin</span><span class="p">(</span><span class="n">comb</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">norm</span> <span class="o">=</span> <span class="p">(</span><span class="n">comb</span> <span class="o">-</span> <span class="n">cmin</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">cmax</span> <span class="o">-</span> <span class="n">cmin</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">norm</span>
    </div>
<div class="viewcode-block" id="computeDis"><a class="viewcode-back" href="../graph_classification.html#graph_classification.computeDis">[docs]</a><span class="k">def</span> <span class="nf">computeDis</span><span class="p">(</span><span class="n">feat1</span><span class="p">,</span><span class="n">feat2</span><span class="p">,</span><span class="n">opt</span> <span class="o">=</span> <span class="s">&#39;Euc&#39;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Compute distance of two vectors.&quot;&quot;&quot;</span>

    <span class="n">dis</span> <span class="o">=</span> <span class="mf">0.0</span>
    <span class="k">if</span> <span class="n">opt</span> <span class="o">==</span> <span class="s">&#39;Euc&#39;</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Euclidean distance&quot;&quot;&quot;</span>    
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">feat1</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
            <span class="n">dis</span> <span class="o">=</span> <span class="n">dis</span> <span class="o">+</span> <span class="p">(</span><span class="n">feat1</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">feat2</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span>
        <span class="n">dis</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">dis</span><span class="p">)</span>
        
    <span class="k">return</span> <span class="n">dis</span>
</div>
<div class="viewcode-block" id="padding"><a class="viewcode-back" href="../graph_classification.html#graph_classification.padding">[docs]</a><span class="k">def</span> <span class="nf">padding</span><span class="p">(</span><span class="n">data1</span><span class="p">,</span><span class="n">data2</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Padding two images to the larger size&quot;&quot;&quot;</span>

    <span class="n">m1</span><span class="p">,</span><span class="n">n1</span> <span class="o">=</span> <span class="n">data1</span><span class="o">.</span><span class="n">shape</span>
    <span class="n">m2</span><span class="p">,</span><span class="n">n2</span> <span class="o">=</span> <span class="n">data2</span><span class="o">.</span><span class="n">shape</span>

    <span class="k">if</span> <span class="n">m1</span> <span class="o">&gt;</span> <span class="n">m2</span><span class="p">:</span>
        <span class="n">up</span> <span class="o">=</span> <span class="p">(</span><span class="n">m1</span> <span class="o">-</span> <span class="n">m2</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span>
        <span class="n">down</span> <span class="o">=</span> <span class="n">m1</span> <span class="o">-</span> <span class="n">m2</span> <span class="o">-</span> <span class="n">up</span>
        <span class="n">data2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">lib</span><span class="o">.</span><span class="n">pad</span><span class="p">(</span><span class="n">data2</span><span class="p">,</span> <span class="p">((</span><span class="n">up</span><span class="p">,</span><span class="n">down</span><span class="p">),(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">)),</span><span class="s">&#39;edge&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">m1</span> <span class="o">&lt;</span> <span class="n">m2</span><span class="p">:</span>
        <span class="n">up</span> <span class="o">=</span> <span class="p">(</span><span class="n">m2</span> <span class="o">-</span> <span class="n">m1</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span>
        <span class="n">down</span> <span class="o">=</span> <span class="n">m2</span> <span class="o">-</span> <span class="n">m1</span> <span class="o">-</span> <span class="n">up</span>
        <span class="n">data1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">lib</span><span class="o">.</span><span class="n">pad</span><span class="p">(</span><span class="n">data1</span><span class="p">,</span> <span class="p">((</span><span class="n">up</span><span class="p">,</span><span class="n">down</span><span class="p">),(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">)),</span><span class="s">&#39;edge&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">n1</span> <span class="o">&gt;</span> <span class="n">n2</span><span class="p">:</span>
        <span class="n">left</span> <span class="o">=</span> <span class="p">(</span><span class="n">n1</span><span class="o">-</span><span class="n">n2</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span>
        <span class="n">right</span> <span class="o">=</span> <span class="n">n1</span><span class="o">-</span><span class="n">n2</span> <span class="o">-</span> <span class="n">left</span>
        <span class="n">data2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">lib</span><span class="o">.</span><span class="n">pad</span><span class="p">(</span><span class="n">data2</span><span class="p">,</span> <span class="p">((</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">),(</span><span class="n">left</span><span class="p">,</span><span class="n">right</span><span class="p">)),</span><span class="s">&#39;edge&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">n1</span> <span class="o">&lt;</span> <span class="n">n2</span><span class="p">:</span>
        <span class="n">left</span> <span class="o">=</span> <span class="p">(</span><span class="n">n2</span><span class="o">-</span><span class="n">n1</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span>
        <span class="n">right</span> <span class="o">=</span> <span class="n">n2</span><span class="o">-</span><span class="n">n1</span> <span class="o">-</span> <span class="n">left</span>
        <span class="n">data1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">lib</span><span class="o">.</span><span class="n">pad</span><span class="p">(</span><span class="n">data1</span><span class="p">,</span> <span class="p">((</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">),(</span><span class="n">left</span><span class="p">,</span><span class="n">right</span><span class="p">)),</span><span class="s">&#39;edge&#39;</span><span class="p">)</span>

    <span class="k">return</span> <span class="p">(</span><span class="n">data1</span><span class="p">,</span><span class="n">data2</span><span class="p">)</span>
</div>
<span class="k">def</span> <span class="nf">_MI</span><span class="p">(</span><span class="n">pdfs1</span><span class="p">,</span> <span class="n">pdfs2</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Compute mutual information of two probability density functions&quot;&quot;&quot;</span>

    <span class="n">numR</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">pdfs1</span><span class="p">)</span>
    <span class="n">mi_map</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">numR</span><span class="p">)</span>
    
    <span class="c"># compute mi</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">numR</span><span class="p">):</span>
      
        <span class="n">mi_map</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">MI</span><span class="o">.</span><span class="n">MI</span><span class="p">(</span><span class="n">pdfs1</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">pdfs2</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>

    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">mi_map</span><span class="p">)</span>


<div class="viewcode-block" id="getPdf"><a class="viewcode-back" href="../graph_classification.html#graph_classification.getPdf">[docs]</a><span class="k">def</span> <span class="nf">getPdf</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">center</span><span class="p">,</span> <span class="n">numR</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span><span class="n">eq</span> <span class="o">=</span> <span class="bp">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Compute the pdf functions of each rings from the ROI&quot;&quot;&quot;</span>

    <span class="c"># equalization before calculating of pdf</span>
    
    <span class="n">pdfs</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">bins</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)):</span>
        <span class="n">data</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">histEqualization</span><span class="o">.</span><span class="n">histEqualization</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">k</span><span class="p">],</span> <span class="mi">16</span><span class="p">)</span>
        <span class="n">pdf</span> <span class="o">=</span> <span class="p">[]</span>
               
        <span class="n">r1</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">dr</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">numR</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">numR</span><span class="p">):</span>
            <span class="n">r2</span> <span class="o">=</span> <span class="n">r1</span> <span class="o">+</span> <span class="n">dr</span>
            
            <span class="n">nr</span><span class="p">,</span><span class="n">nc</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span>
            <span class="n">X</span><span class="p">,</span> <span class="n">Y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ogrid</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">nr</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span><span class="n">nc</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">mask1</span> <span class="o">=</span> <span class="p">(</span><span class="n">X</span> <span class="o">-</span> <span class="n">center</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">Y</span> <span class="o">-</span> <span class="n">center</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span> <span class="o">&lt;</span> <span class="n">r1</span><span class="o">**</span><span class="mi">2</span>
            <span class="n">mask2</span> <span class="o">=</span> <span class="p">(</span><span class="n">X</span> <span class="o">-</span> <span class="n">center</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">Y</span> <span class="o">-</span> <span class="n">center</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span> <span class="o">&lt;</span> <span class="n">r2</span><span class="o">**</span><span class="mi">2</span>
            <span class="n">mask</span> <span class="o">=</span> <span class="n">mask2</span><span class="o">-</span><span class="n">mask1</span>
            <span class="n">ring</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="n">mask</span><span class="p">]</span>      

            <span class="c"># normalize</span>
            <span class="n">ring</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">double</span><span class="p">(</span><span class="n">ring</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">ring</span><span class="p">))</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">double</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">ring</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">ring</span><span class="p">))</span>
            <span class="n">pdfi</span><span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">histogram</span><span class="p">(</span><span class="n">ring</span><span class="p">,</span> <span class="n">bins</span><span class="p">)</span>

            <span class="n">pdfi</span> <span class="o">=</span> <span class="n">pdfi</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">double</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">pdfi</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
            <span class="n">pdf</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pdfi</span><span class="p">)</span>
            

            <span class="n">r1</span> <span class="o">=</span> <span class="n">r1</span> <span class="o">+</span> <span class="n">dr</span>
            <span class="n">dr</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">dr</span> <span class="o">-</span> <span class="mi">2</span><span class="p">,</span><span class="mi">5</span><span class="p">)</span>

        <span class="n">pdfs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pdf</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">pdfs</span>

   </div>
<div class="viewcode-block" id="computeIntensityCorrelation"><a class="viewcode-back" href="../graph_classification.html#graph_classification.computeIntensityCorrelation">[docs]</a><span class="k">def</span> <span class="nf">computeIntensityCorrelation</span><span class="p">(</span><span class="n">intenSuspicious</span><span class="p">,</span> <span class="n">intenSource</span><span class="p">,</span> <span class="n">intenSink</span><span class="p">,</span> <span class="n">cenSuspicious</span><span class="p">,</span> <span class="n">cenSource</span><span class="p">,</span> <span class="n">cenSink</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Computer intensity correlation of two ROIs</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    intenSuspicious: list of numpy array(2D)</span>
<span class="sd">        Testing ROI intensity lists</span>
<span class="sd">    intenSource:</span>
<span class="sd">        Training positive ROI intensity lists</span>
<span class="sd">    intenSink:</span>
<span class="sd">        Training negative ROI intensity lists</span>
<span class="sd">    cenSuspicious: list of tuples with coordination</span>
<span class="sd">        The center coordinations of all suspicious data point</span>
<span class="sd">    cenSource: list of tuples with coordination</span>
<span class="sd">        The center coordinations of all positive data point</span>
<span class="sd">    cenSink: list of tuples with coordination</span>
<span class="sd">        The center coordinations of all negative data point</span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">numSus</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">intenSuspicious</span><span class="p">)</span>
    <span class="n">numSor</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">intenSource</span><span class="p">)</span>
    <span class="n">numSin</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">intenSink</span><span class="p">)</span>

    <span class="n">pdfsource</span> <span class="o">=</span> <span class="n">getPdf</span><span class="p">(</span><span class="n">intenSource</span><span class="p">,</span> <span class="n">cenSource</span><span class="p">,</span><span class="n">eq</span> <span class="o">=</span> <span class="bp">True</span><span class="p">)</span>
    <span class="n">pdfsink</span> <span class="o">=</span> <span class="n">getPdf</span><span class="p">(</span><span class="n">intenSink</span><span class="p">,</span> <span class="n">cenSink</span><span class="p">,</span><span class="n">eq</span> <span class="o">=</span> <span class="bp">True</span><span class="p">)</span>
    <span class="n">pdfSuspicious</span> <span class="o">=</span> <span class="n">getPdf</span><span class="p">(</span><span class="n">intenSuspicious</span><span class="p">,</span> <span class="n">cenSuspicious</span><span class="p">,</span><span class="n">eq</span> <span class="o">=</span> <span class="bp">False</span><span class="p">)</span>

    <span class="n">weightIntens</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">numSus</span> <span class="o">+</span> <span class="n">numSor</span> <span class="o">+</span> <span class="n">numSin</span><span class="p">,</span><span class="n">numSus</span> <span class="o">+</span> <span class="n">numSor</span> <span class="o">+</span> <span class="n">numSin</span><span class="p">),</span><span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">double</span><span class="p">)</span>
	
    <span class="n">val_min</span> <span class="o">=</span> <span class="mf">0.0</span>
    <span class="n">val_max</span> <span class="o">=</span> <span class="mf">10.0</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">numSor</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">numSor</span><span class="p">):</span>
            <span class="n">weightIntens</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">val_min</span> <span class="c">#_MI(pdfsource[i],pdfsource[j])</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">numSin</span><span class="p">):</span>
            <span class="n">weightIntens</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="o">+</span><span class="n">numSor</span><span class="p">]</span> <span class="o">=</span> <span class="n">val_max</span> <span class="c">#_MI(pdfsource[i],pdfsink[j])</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">numSus</span><span class="p">):</span>
            <span class="n">weightIntens</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="o">+</span><span class="n">numSor</span><span class="o">+</span><span class="n">numSin</span><span class="p">]</span> <span class="o">=</span> <span class="n">_MI</span><span class="p">(</span><span class="n">pdfsource</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">pdfSuspicious</span><span class="p">[</span><span class="n">j</span><span class="p">])</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">numSin</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">numSin</span><span class="p">):</span>
            <span class="n">weightIntens</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="n">numSor</span><span class="p">][</span><span class="n">j</span><span class="o">+</span><span class="n">numSor</span><span class="p">]</span> <span class="o">=</span> <span class="n">val_min</span> <span class="c">#_MI(pdfsink[i],pdfsink[j])</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">numSus</span><span class="p">):</span>
            <span class="n">weightIntens</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="n">numSor</span><span class="p">][</span><span class="n">j</span><span class="o">+</span><span class="n">numSor</span><span class="o">+</span><span class="n">numSin</span><span class="p">]</span> <span class="o">=</span> <span class="n">_MI</span><span class="p">(</span><span class="n">pdfsink</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">pdfSuspicious</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="p">)</span>


    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">numSus</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">numSus</span><span class="p">):</span>
            <span class="n">weightIntens</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="n">numSor</span><span class="o">+</span><span class="n">numSin</span><span class="p">][</span><span class="n">j</span><span class="o">+</span><span class="n">numSor</span><span class="o">+</span><span class="n">numSin</span><span class="p">]</span> <span class="o">=</span> <span class="n">_MI</span><span class="p">(</span><span class="n">pdfSuspicious</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">pdfSuspicious</span><span class="p">[</span><span class="n">j</span><span class="p">])</span>
        
    <span class="k">return</span> <span class="n">weightIntens</span>

</div>
<div class="viewcode-block" id="computeSpatialCorrelation"><a class="viewcode-back" href="../graph_classification.html#graph_classification.computeSpatialCorrelation">[docs]</a><span class="k">def</span> <span class="nf">computeSpatialCorrelation</span><span class="p">(</span><span class="n">coordSuspicious</span><span class="p">,</span> <span class="n">numSor</span><span class="p">,</span> <span class="n">numSin</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Computer spacial correlation of ROIs</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    coordSuspicious: list of tuples</span>
<span class="sd">        The Coordination of all testing RIO</span>
<span class="sd">    numSor:</span>
<span class="sd">        The number of source data point</span>
<span class="sd">    numSin:</span>
<span class="sd">        The number of sink data point</span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">numSus</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">coordSuspicious</span><span class="p">)</span>

    <span class="n">weightSpatial</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">numSus</span> <span class="o">+</span> <span class="n">numSor</span> <span class="o">+</span> <span class="n">numSin</span><span class="p">,</span><span class="n">numSus</span> <span class="o">+</span> <span class="n">numSor</span> <span class="o">+</span> <span class="n">numSin</span><span class="p">),</span><span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">double</span><span class="p">)</span>

    <span class="n">disSorSor</span> <span class="o">=</span> <span class="mf">0.0</span>
    <span class="n">disSorSin</span> <span class="o">=</span> <span class="mf">1.0</span>
    <span class="n">disSorSus</span> <span class="o">=</span> <span class="mf">0.5</span>
    <span class="n">disSinSin</span> <span class="o">=</span> <span class="mf">0.0</span>
    <span class="n">disSinSus</span> <span class="o">=</span> <span class="mf">0.5</span>   <span class="c"># need to be adjusted</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">numSor</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">numSor</span><span class="p">):</span>
            <span class="n">weightSpatial</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">disSorSor</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">numSin</span><span class="p">):</span>
            <span class="n">weightSpatial</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="o">+</span><span class="n">numSor</span><span class="p">]</span> <span class="o">=</span> <span class="n">disSorSin</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">numSus</span><span class="p">):</span>
            <span class="n">weightSpatial</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="o">+</span><span class="n">numSor</span><span class="o">+</span><span class="n">numSin</span><span class="p">]</span> <span class="o">=</span> <span class="n">disSorSus</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">numSin</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">numSin</span><span class="p">):</span>
            <span class="n">weightSpatial</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="n">numSor</span><span class="p">][</span><span class="n">j</span><span class="o">+</span><span class="n">numSor</span><span class="p">]</span> <span class="o">=</span> <span class="n">disSinSin</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">numSus</span><span class="p">):</span>
            <span class="n">weightSpatial</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="n">numSor</span><span class="p">][</span><span class="n">j</span><span class="o">+</span><span class="n">numSor</span><span class="o">+</span><span class="n">numSin</span><span class="p">]</span> <span class="o">=</span> <span class="n">disSinSus</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">numSus</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">numSus</span><span class="p">):</span>
            <span class="n">weightSpatial</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="n">numSor</span><span class="o">+</span><span class="n">numSin</span><span class="p">][</span><span class="n">j</span><span class="o">+</span><span class="n">numSor</span><span class="o">+</span><span class="n">numSin</span><span class="p">]</span> <span class="o">=</span> <span class="n">computeSpaDis</span><span class="p">(</span><span class="n">coordSuspicious</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">coordSuspicious</span><span class="p">[</span><span class="n">j</span><span class="p">])</span>

    <span class="c"># Normalize susipicious distances </span>
    <span class="n">val_max</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">weightSpatial</span><span class="p">)</span>
    <span class="n">start</span> <span class="o">=</span> <span class="n">numSor</span><span class="o">+</span><span class="n">numSin</span>
    <span class="n">end</span> <span class="o">=</span> <span class="n">numSor</span><span class="o">+</span><span class="n">numSin</span> <span class="o">+</span> <span class="n">numSus</span>
    <span class="n">weightSpatial</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">end</span><span class="p">,</span><span class="n">start</span><span class="p">:</span><span class="n">end</span><span class="p">]</span> <span class="o">=</span> <span class="n">weightSpatial</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">end</span><span class="p">,</span><span class="n">start</span><span class="p">:</span><span class="n">end</span><span class="p">]</span><span class="o">/</span><span class="n">val_max</span>
       
    <span class="k">return</span> <span class="n">weightSpatial</span>
</div>
<div class="viewcode-block" id="computeSpaDis"><a class="viewcode-back" href="../graph_classification.html#graph_classification.computeSpaDis">[docs]</a><span class="k">def</span> <span class="nf">computeSpaDis</span><span class="p">(</span><span class="n">coord_1</span><span class="p">,</span><span class="n">coord_2</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Computer spacial correlation of two ROIs</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    coord_1:</span>
<span class="sd">        The coordination of the first ROI</span>
<span class="sd">    coord_2:</span>
<span class="sd">        The coordination of the second ROI</span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>
	
    <span class="n">spatio</span> <span class="o">=</span> <span class="mi">5</span>
    <span class="n">spaDis</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">coord_1</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">coord_2</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">coord_1</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">coord_2</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">spatio</span><span class="o">*</span><span class="n">coord_1</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="n">spatio</span><span class="o">*</span><span class="n">coord_2</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span> <span class="p">)</span>

    <span class="k">return</span> <span class="n">spaDis</span>

    </div>
<div class="viewcode-block" id="computeWeight"><a class="viewcode-back" href="../graph_classification.html#graph_classification.computeWeight">[docs]</a><span class="k">def</span> <span class="nf">computeWeight</span><span class="p">(</span><span class="n">sliceList</span><span class="p">,</span> <span class="n">sourceSams</span><span class="p">,</span> <span class="n">sinkSams</span><span class="p">,</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">beta</span> <span class="o">=</span> <span class="mf">0.1</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Computer the weigh between ROIs using intensity, coordination and features.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    sliceList:</span>
<span class="sd">        List of suspicious data</span>
<span class="sd">    sourceSams:</span>
<span class="sd">        List positive data</span>
<span class="sd">    sinkSams:</span>
<span class="sd">        List of negative data</span>
<span class="sd">    alpha:</span>
<span class="sd">        Weight coefficient for feature correlation</span>
<span class="sd">    beta:</span>
<span class="sd">        Weight coefficient for spatial correlation</span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>


    <span class="n">numSource</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">sourceSams</span><span class="p">)</span>
    <span class="n">numSink</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">sinkSams</span><span class="p">)</span>
    <span class="n">numSuspicious</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">sliceList</span><span class="p">)):</span>
        <span class="n">numSuspicious</span> <span class="o">=</span> <span class="n">numSuspicious</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">sliceList</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">LightPatchList</span><span class="p">)</span>

    <span class="n">numNode</span> <span class="o">=</span> <span class="n">numSource</span> <span class="o">+</span> <span class="n">numSink</span> <span class="o">+</span> <span class="n">numSuspicious</span>

    <span class="c">## prepare data for the following process</span>
    <span class="n">numFeat</span> <span class="o">=</span> <span class="n">sliceList</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">feats</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="c"># source data</span>
    <span class="n">featSource</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">numSource</span><span class="p">,</span><span class="n">numFeat</span><span class="p">),</span><span class="n">np</span><span class="o">.</span><span class="n">double</span><span class="p">)</span>
    <span class="n">intenSource</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">cenSource</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">numSource</span><span class="p">):</span>
        <span class="n">featSource</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">sourceSams</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">feats</span>
        <span class="n">intenSource</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sourceSams</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">pdata</span><span class="p">)</span>
        <span class="n">cenSource</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sourceSams</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">patch_center</span><span class="p">)</span>
        
    <span class="c"># sink data</span>
    <span class="n">featSink</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">numSink</span><span class="p">,</span><span class="n">numFeat</span><span class="p">),</span><span class="n">np</span><span class="o">.</span><span class="n">double</span><span class="p">)</span>
    <span class="n">intenSink</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">cenSink</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">numSink</span><span class="p">):</span>
        <span class="n">featSink</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">sinkSams</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">feats</span>
        <span class="n">intenSink</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sinkSams</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">pdata</span><span class="p">)</span>
        <span class="n">cenSink</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sinkSams</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">patch_center</span><span class="p">)</span>

    <span class="c"># suspicious data</span>
    <span class="n">featSuspicious</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">numSuspicious</span><span class="p">,</span><span class="n">numFeat</span><span class="p">),</span><span class="n">np</span><span class="o">.</span><span class="n">double</span><span class="p">)</span>
    <span class="n">intenSuspicious</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">coordSuspicious</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">cenSuspicious</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">counter</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">sliceList</span><span class="p">)):</span>
        
        <span class="n">numPatch</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">sliceList</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">LightPatchList</span><span class="p">)</span>
        <span class="n">featSuspicious</span><span class="p">[</span><span class="n">counter</span><span class="p">:</span><span class="n">counter</span> <span class="o">+</span> <span class="n">numPatch</span><span class="p">]</span> <span class="o">=</span> <span class="n">sliceList</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">feats</span>
        <span class="n">counter</span> <span class="o">=</span> <span class="n">counter</span> <span class="o">+</span> <span class="n">numPatch</span>

        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">numPatch</span><span class="p">):</span>
            <span class="n">intenSuspicious</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sliceList</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">LightPatchList</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">pdata</span><span class="p">)</span>
            <span class="n">coordSuspicious</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sliceList</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">LightPatchList</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">image_center</span><span class="p">)</span>
            <span class="n">cenSuspicious</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sliceList</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">LightPatchList</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">patch_center</span><span class="p">)</span>
            
    <span class="c">#outputPath = &#39;C:/Tomosynthesis/localtest/res/&#39;</span>
    <span class="c">#np.savetxt(outputPath + &#39;featSuspicious.txt&#39;, featSuspicious, delimiter=&#39;\t&#39;)</span>
    <span class="c">#np.savetxt(outputPath + &#39;featSource.txt&#39;, featSource, delimiter=&#39;\t&#39;)</span>
    <span class="c">#np.savetxt(outputPath + &#39;featSink.txt&#39;, featSink, delimiter=&#39;\t&#39;)</span>
    
    <span class="c"># compute feature correlation    </span>
    <span class="n">weightFeat</span> <span class="o">=</span> <span class="n">computeFeatureCorrelation</span><span class="p">(</span><span class="n">featSuspicious</span><span class="p">,</span> <span class="n">featSource</span><span class="p">,</span> <span class="n">featSink</span><span class="p">)</span>
    <span class="c">#np.savetxt(outputPath + &#39;featcorrelation.txt&#39;, weightFeat, delimiter=&#39;\t&#39;)</span>
    <span class="k">print</span> <span class="s">&#39;done feature correlation&#39;</span>

    <span class="c"># compute spatial connection</span>
    <span class="n">weightSpatial</span> <span class="o">=</span> <span class="n">computeSpatialCorrelation</span><span class="p">(</span><span class="n">coordSuspicious</span><span class="p">,</span> <span class="n">numSource</span><span class="p">,</span> <span class="n">numSink</span><span class="p">)</span>
    <span class="c">#np.savetxt(outputPath + &#39;spatcorrelation.txt&#39;, weightSpatial, delimiter=&#39;\t&#39;)</span>
    <span class="k">print</span> <span class="s">&#39;done spatial correlation&#39;</span>
    
       
    <span class="c"># compute intensity mutual information  </span>
    <span class="n">weightInten</span> <span class="o">=</span> <span class="n">computeIntensityCorrelation</span><span class="p">(</span><span class="n">intenSuspicious</span><span class="p">,</span> <span class="n">intenSource</span><span class="p">,</span> <span class="n">intenSink</span><span class="p">,</span><span class="n">cenSuspicious</span><span class="p">,</span> <span class="n">cenSource</span><span class="p">,</span> <span class="n">cenSink</span><span class="p">)</span>
    <span class="c">#np.savetxt(outputPath + &#39;mutualinformation.txt&#39;, weightInten, delimiter=&#39;\t&#39;)</span>
    <span class="k">print</span> <span class="s">&#39;done intensity correlation&#39;</span>

    <span class="c">#regularized weight</span>
    <span class="n">weight</span> <span class="o">=</span> <span class="n">alpha</span><span class="o">*</span><span class="n">weightFeat</span> <span class="o">+</span> <span class="n">beta</span><span class="o">*</span><span class="n">weightSpatial</span> <span class="c">#+ weightInten</span>
    <span class="n">weight</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">weight</span><span class="p">)</span> <span class="o">-</span> <span class="n">weight</span>
    <span class="c">#np.savetxt(outputPath + &#39;weight.txt&#39;, weight, delimiter=&#39;\t&#39;)</span>

    <span class="k">return</span> <span class="n">weight</span>

</div>
<div class="viewcode-block" id="buildGraph"><a class="viewcode-back" href="../graph_classification.html#graph_classification.buildGraph">[docs]</a><span class="k">def</span> <span class="nf">buildGraph</span><span class="p">(</span><span class="n">numSource</span><span class="p">,</span><span class="n">numSink</span><span class="p">,</span><span class="n">numSuspicious</span><span class="p">,</span><span class="n">weight</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Build a graph with all positive data points as source, and all negative</span>
<span class="sd">    data points as sink.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    </span>
<span class="sd">    numSource: integer</span>
<span class="sd">        The number of positive data points</span>
<span class="sd">    numSink: integer</span>
<span class="sd">        The number of negative data points</span>
<span class="sd">    numSuspicious: integer</span>
<span class="sd">        The number of suspicious data points</span>
<span class="sd">    weight: numpy array (2D)</span>
<span class="sd">        The weight matrix</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">numTot</span> <span class="o">=</span> <span class="n">numSource</span> <span class="o">+</span> <span class="n">numSink</span> <span class="o">+</span> <span class="n">numSuspicious</span>
    
    <span class="c"># symmytrize weight</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">numTot</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">i</span><span class="p">):</span>
            <span class="n">weight</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">weight</span><span class="p">[</span><span class="n">j</span><span class="p">,</span><span class="n">i</span><span class="p">]</span>

    <span class="c">#outputPath = &#39;C:/Tomosynthesis/localtest/res/&#39;</span>
    <span class="c">#np.savetxt(outputPath + &#39;weight_symmetrical.txt&#39;, weight, delimiter=&#39;\t&#39;)</span>
    
    <span class="c"># build graph</span>
    <span class="n">gr</span> <span class="o">=</span> <span class="n">digraph</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">numTot</span><span class="p">):</span>
        <span class="n">gr</span><span class="o">.</span><span class="n">add_nodes</span><span class="p">([</span><span class="n">i</span><span class="p">])</span>

    
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">numTot</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="n">numSource</span><span class="p">:</span>
            <span class="k">continue</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c"># connect source to other nodes except sink</span>
            <span class="n">gr</span><span class="o">.</span><span class="n">add_edge</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span><span class="n">i</span><span class="p">),</span> <span class="n">weight</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">i</span><span class="p">])</span>
            
            <span class="c"># connect nodes to the sink </span>
            <span class="n">gr</span><span class="o">.</span><span class="n">add_edge</span><span class="p">((</span><span class="n">i</span><span class="p">,</span><span class="n">numSource</span><span class="p">),</span> <span class="n">weight</span><span class="p">[</span><span class="n">numSource</span><span class="p">][</span><span class="n">i</span><span class="p">])</span>
            
            <span class="c"># connect all other nodes to each other, make sure no loop</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">numTot</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">j</span> <span class="o">==</span> <span class="n">numSource</span><span class="p">:</span>
                    <span class="k">continue</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">gr</span><span class="o">.</span><span class="n">add_edge</span><span class="p">((</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">),</span> <span class="n">weight</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="n">i</span><span class="p">])</span>

    <span class="k">return</span> <span class="n">gr</span>
</div>
<div class="viewcode-block" id="classify"><a class="viewcode-back" href="../graph_classification.html#graph_classification.classify">[docs]</a><span class="k">def</span> <span class="nf">classify</span><span class="p">(</span><span class="n">gr</span><span class="p">,</span><span class="n">numSource</span><span class="p">,</span><span class="n">numSink</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Classify using the built graph by the max_flow algorithm</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    </span>
<span class="sd">    gr: </span>
<span class="sd">        The graph model</span>
<span class="sd">    numSource: integer</span>
<span class="sd">        The number of positive data points</span>
<span class="sd">    numSink: integer</span>
<span class="sd">        The number of negative data points</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="n">flows</span><span class="p">,</span> <span class="n">cuts</span> <span class="o">=</span> <span class="n">maximum_flow</span><span class="p">(</span><span class="n">gr</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">numSource</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">cuts</span>

    </div>
<div class="viewcode-block" id="mainClassify"><a class="viewcode-back" href="../graph_classification.html#graph_classification.mainClassify">[docs]</a><span class="k">def</span> <span class="nf">mainClassify</span><span class="p">(</span><span class="n">sliceList</span><span class="p">,</span><span class="n">sourceSams</span><span class="p">,</span><span class="n">sinkSams</span><span class="p">,</span><span class="n">alpha</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span><span class="n">beta</span> <span class="o">=</span> <span class="mf">0.2</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Main function for classification using graph cut.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    sliceList:</span>
<span class="sd">        List of suspicious data</span>
<span class="sd">    sourceSams:</span>
<span class="sd">        List positive data</span>
<span class="sd">    sinkSams:</span>
<span class="sd">        List of negative data</span>
<span class="sd">    alpha:</span>
<span class="sd">        Weight coefficient for feature correlation</span>
<span class="sd">    beta:</span>
<span class="sd">        Weight coefficient for spatial correlation</span>

<span class="sd">    &quot;&quot;&quot;</span> 
    
    <span class="n">numSource</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">sourceSams</span><span class="p">)</span>
    <span class="n">numSink</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">sinkSams</span><span class="p">)</span>
    <span class="n">numSuspicious</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">sliceList</span><span class="p">)):</span>
        <span class="n">numSuspicious</span> <span class="o">=</span> <span class="n">numSuspicious</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">sliceList</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">LightPatchList</span><span class="p">)</span>

    <span class="n">numNode</span> <span class="o">=</span> <span class="n">numSource</span> <span class="o">+</span> <span class="n">numSink</span> <span class="o">+</span> <span class="n">numSuspicious</span>
    
    <span class="c">#compute weight function</span>
    <span class="k">print</span> <span class="s">&#39;Computing weight ...&#39;</span>
    <span class="n">weight</span> <span class="o">=</span> <span class="n">computeWeight</span><span class="p">(</span><span class="n">sliceList</span><span class="p">,</span> <span class="n">sourceSams</span><span class="p">,</span> <span class="n">sinkSams</span><span class="p">,</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">beta</span><span class="p">)</span>
    
    
    <span class="c">#build graph</span>
    <span class="k">print</span> <span class="s">&#39;building graph...&#39;</span>
    <span class="n">gr</span> <span class="o">=</span> <span class="n">buildGraph</span><span class="p">(</span><span class="n">numSource</span><span class="p">,</span><span class="n">numSink</span><span class="p">,</span><span class="n">numSuspicious</span><span class="p">,</span><span class="n">weight</span><span class="p">)</span>
    
    <span class="c">#classify</span>
    <span class="k">print</span> <span class="s">&#39;Classifying...&#39;</span>
    <span class="n">predicts</span> <span class="o">=</span> <span class="n">classify</span><span class="p">(</span><span class="n">gr</span><span class="p">,</span><span class="n">numSource</span><span class="p">,</span><span class="n">numSink</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">predicts</span>


    
    </div>
</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../Tomo.html">Tomosynthesis Machine Learning 1.0 documentation</a> &raquo;</li>
          <li><a href="index.html" >Module code</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2014, SAP.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2.3.
    </div>
  </body>
</html>